import{x as e,r as a,c as t,w as l,k as s,y as n,A as o,P as u,I as i,H as r,ag as c,L as d,M as v,O as m,a6 as y,u as h,aq as D,J as g,D as w,az as k,z as p,G as f}from"./vue-CYQ3jvsg.js";import{u as C,P as b}from"./project-B2gwCvL8.js";import{E as _}from"./elementPlus-D3jm9WeK.js";import{_ as M}from"./index-CSUhv2L2.js";import"./index-fZjk1EK6.js";const L={class:"calendar-view"},j={class:"calendar-container"},$={class:"calendar-toolbar"},z={class:"date-navigator"},V={class:"current-date"},N={class:"calendar-filter"},S={class:"calendar-body"},T={key:0,class:"month-view"},P={class:"weekday-header"},x={class:"month-grid"},F={class:"day-number"},I={class:"day-events"},Y=["onClick"],A={key:1,class:"week-view"},H={class:"weekday-header"},U={class:"week-grid"},q={class:"hour-label"},E=["onClick"],G={key:2,class:"day-view"},J={class:"day-schedule"},O={class:"hour-label"},B={class:"hour-events"},K=["onClick"],Q={key:0,class:"event-details"},R={class:"detail-item"},W={class:"value"},X={class:"detail-item"},Z={class:"value"},ee={class:"detail-item"},ae={class:"value"},te={class:"detail-item"},le={class:"value"},se={class:"detail-item"},ne={key:0,class:"detail-item"},oe={class:"value"},ue={class:"dialog-footer"},ie=M(e({__name:"CalendarView",setup(e){const M=k(),ie=C(),re=a("month"),ce=a(new Date),de=a(""),ve=a(!1),me=a(!1),ye=a(null),he=t((()=>{const e=ce.value;if("month"===re.value)return e.toLocaleDateString("zh-CN",{year:"numeric",month:"long"});if("week"===re.value){const a=new Date(e),t=e.getDay(),l=e.getDate()-t+(0===t?-6:1);a.setDate(l);const s=new Date(a);s.setDate(a.getDate()+6);return`${a.toLocaleDateString("zh-CN",{month:"long",day:"numeric"})} - ${s.toLocaleDateString("zh-CN",{month:"long",day:"numeric"})}`}return e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})})),De=["周日","周一","周二","周三","周四","周五","周六"],ge=t((()=>{const e=new Date(ce.value),a=e.getFullYear(),t=e.getMonth(),l=new Date(a,t,1).getDay(),s=new Date(a,t+1,0).getDate(),n=new Date(a,t,0).getDate(),o=new Date,u=[];for(let r=l-1;r>=0;r--){const e=new Date(a,t-1,n-r);u.push({date:e,currentMonth:!1,isToday:Ce(e,o),events:pe(e)})}for(let r=1;r<=s;r++){const e=new Date(a,t,r);u.push({date:e,currentMonth:!0,isToday:Ce(e,o),events:pe(e)})}const i=42-u.length;for(let r=1;r<=i;r++){const e=new Date(a,t+1,r);u.push({date:e,currentMonth:!1,isToday:Ce(e,o),events:pe(e)})}return u})),we=t((()=>{const e=new Date(ce.value),a=e.getDay(),t=e.getDate()-a+(0===a?-6:1),l=new Date,s=[];for(let n=0;n<7;n++){const a=new Date(e);a.setDate(t+n),s.push({date:a,name:De[a.getDay()],isToday:Ce(a,l),events:pe(a)})}return s})),ke=t((()=>new Date(ce.value)));function pe(e){return ie.projects.filter((a=>{if(de.value&&a.status!==de.value)return!1;return Ce(new Date(a.onlineDate),e)}))}function fe(e,a){return pe(e).filter((e=>new Date(e.onlineDate).getHours()===a))}function Ce(e,a){return e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate()}function be(e){re.value=e}function _e(){const e=new Date(ce.value);"month"===re.value?e.setMonth(e.getMonth()-1):"week"===re.value?e.setDate(e.getDate()-7):e.setDate(e.getDate()-1),ce.value=e}function Me(){const e=new Date(ce.value);"month"===re.value?e.setMonth(e.getMonth()+1):"week"===re.value?e.setDate(e.getDate()+7):e.setDate(e.getDate()+1),ce.value=e}function Le(){ce.value=new Date}function je(e){ye.value=e,me.value=!0}function $e(){ye.value&&M.push(`/project/edit/${ye.value.id}`),me.value=!1}return l(de,(()=>{})),s((async()=>{ve.value=!0;try{await ie.fetchAllProjects()}catch(e){_.error("获取项目数据失败")}finally{ve.value=!1}})),(e,a)=>{const t=c("el-button"),l=c("el-button-group"),s=c("el-option"),k=c("el-select"),C=c("el-dialog"),_=D("loading");return p(),n("div",L,[a[19]||(a[19]=o("h1",null,"项目日历",-1)),o("div",j,[o("div",$,[u(l,null,{default:r((()=>[u(t,{type:"primary",onClick:a[0]||(a[0]=e=>be("month"))},{default:r((()=>a[6]||(a[6]=[d("月视图")]))),_:1}),u(t,{type:"primary",onClick:a[1]||(a[1]=e=>be("week"))},{default:r((()=>a[7]||(a[7]=[d("周视图")]))),_:1}),u(t,{type:"primary",onClick:a[2]||(a[2]=e=>be("day"))},{default:r((()=>a[8]||(a[8]=[d("日视图")]))),_:1})])),_:1}),o("div",z,[u(t,{icon:"el-icon-arrow-left",onClick:_e}),o("span",V,v(he.value),1),u(t,{icon:"el-icon-arrow-right",onClick:Me}),u(t,{onClick:Le},{default:r((()=>a[9]||(a[9]=[d("今天")]))),_:1})]),o("div",N,[u(k,{modelValue:de.value,"onUpdate:modelValue":a[3]||(a[3]=e=>de.value=e),placeholder:"项目状态",clearable:""},{default:r((()=>[(p(!0),n(m,null,y(h(b),((e,a)=>(p(),f(s,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),i((p(),n("div",S,["month"===re.value?(p(),n("div",T,[o("div",P,[(p(),n(m,null,y(De,(e=>o("div",{key:e,class:"weekday"},v(e),1))),64))]),o("div",x,[(p(!0),n(m,null,y(ge.value,((e,a)=>(p(),n("div",{key:a,class:w(["day-cell",{"current-month":e.currentMonth,today:e.isToday}])},[o("div",F,v(e.date.getDate()),1),o("div",I,[(p(!0),n(m,null,y(e.events,(e=>(p(),n("div",{key:e.id,class:w(["event-item",`status-${e.status.toLowerCase()}`]),onClick:a=>je(e)},v(e.name),11,Y)))),128))])],2)))),128))])])):"week"===re.value?(p(),n("div",A,[o("div",H,[a[10]||(a[10]=o("div",{class:"hour-column"},null,-1)),(p(!0),n(m,null,y(we.value,((e,a)=>(p(),n("div",{key:a,class:w(["weekday",{today:e.isToday}])},v(e.name)+" "+v(e.date.getDate()),3)))),128))]),o("div",U,[(p(),n(m,null,y(24,(e=>o("div",{key:e,class:"hour-row"},[o("div",q,v(e-1)+":00",1),(p(!0),n(m,null,y(we.value,((a,t)=>(p(),n("div",{key:`day-${t}-hour-${e}`,class:"day-column"},[(p(!0),n(m,null,y(fe(a.date,e-1),(e=>(p(),n("div",{key:e.id,class:w(["event-item",`status-${e.status.toLowerCase()}`]),onClick:a=>je(e)},v(e.name),11,E)))),128))])))),128))]))),64))])])):(p(),n("div",G,[o("h3",null,v(ke.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})),1),o("div",J,[(p(),n(m,null,y(24,(e=>o("div",{key:e,class:"hour-block"},[o("div",O,v(e-1)+":00",1),o("div",B,[(p(!0),n(m,null,y(fe(ke.value,e-1),(e=>(p(),n("div",{key:e.id,class:w(["event-item",`status-${e.status.toLowerCase()}`]),onClick:a=>je(e)},v(e.name),11,K)))),128))])]))),64))])]))])),[[_,ve.value]])]),u(C,{title:"项目详情",modelValue:me.value,"onUpdate:modelValue":a[5]||(a[5]=e=>me.value=e),width:"50%"},{footer:r((()=>[o("span",ue,[u(t,{onClick:a[4]||(a[4]=e=>me.value=!1)},{default:r((()=>a[17]||(a[17]=[d("关闭")]))),_:1}),u(t,{type:"primary",onClick:$e},{default:r((()=>a[18]||(a[18]=[d("编辑项目")]))),_:1})])])),default:r((()=>{return[ye.value?(p(),n("div",Q,[o("div",R,[a[11]||(a[11]=o("span",{class:"label"},"项目名称:",-1)),o("span",W,v(ye.value.name),1)]),o("div",X,[a[12]||(a[12]=o("span",{class:"label"},"项目ID:",-1)),o("span",Z,v(ye.value.id),1)]),o("div",ee,[a[13]||(a[13]=o("span",{class:"label"},"评审期:",-1)),o("span",ae,v(ye.value.reviewPeriod),1)]),o("div",te,[a[14]||(a[14]=o("span",{class:"label"},"上线日期:",-1)),o("span",le,v((e=ye.value.onlineDate,new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))),1)]),o("div",se,[a[15]||(a[15]=o("span",{class:"label"},"状态:",-1)),o("span",{class:w(["value",`status-${ye.value.status.toLowerCase()}`])},v(h(b)[ye.value.status]),3)]),ye.value.remark?(p(),n("div",ne,[a[16]||(a[16]=o("span",{class:"label"},"备注:",-1)),o("span",oe,v(ye.value.remark),1)])):g("",!0)])):g("",!0)];var e})),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-a9e2f76e"]]);export{ie as default};
